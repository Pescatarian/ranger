<!DOCTYPE html>
<html>
<head>
    <title>Ranger</title>
    <style>
        body {
            background-color: #1a1a1a;
            color: #4CAF50;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            user-select: none;
        }

        .main-container {
            flex: 1;
            padding: 20px;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(8, 100px);
            gap: 1px;
            background-color: #2d2d2d;
            padding: 1px;
            width: fit-content;
            aspect-ratio: 1;
        }

        .cell {
            width: 100px;
            height: 100px;
            background-color: #1a1a1a;
            border: 1px solid #444;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            cursor: pointer;
        }

        .cell-content {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cell-id {
            position: absolute;
            top: 5px;
            left: 5px;
            font-size: 12px;
            opacity: 0.7;
        }

        .button {
            padding: 8px 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s ease;
        }

        .button.active {
            background-color: #45a049;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
            border: 2px solid #fff;
            transform: scale(1.05);
        }

        /* Range Builder Sidebar */
        .sidebar {
            width: 600px;
            background-color: #2d2d2d;
            padding: 20px;
            border-left: 1px solid #444;
            display: none;
            position: fixed;
            right: 0;
            top: 0;
            height: 100vh;
            flex-direction: column;
            align-items: center;
        }

       .sidebar h2 {
    color: #4CAF50;
    margin-top: 20px;  /* Reduced from 60px to 20px */
    width: 100%;
    padding-left: 20px;
}

.range-grid {
    display: grid;
    grid-template-columns: repeat(13, 1fr);
    gap: 4px;
    margin: 10px 20px;  /* Reduced top margin from 20px to 10px */
    width: calc(100% - 40px);
    aspect-ratio: 1;
    margin-bottom: 20px;
}
        .range-cell {
            aspect-ratio: 1;
            background-color: #1a1a1a;
            border: 1px solid #444;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            cursor: pointer;
            color: #4CAF50;
            position: relative;
            overflow: hidden;
        }

        .range-cell:hover {
            background-color: #2d2d2d;
        }

        .range-cell.selected {
            color: white;
            position: relative;
            z-index: 1;
        }

        .range-cell.selected::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            width: var(--weight-height, 100%);
            background-color: #4CAF50;
            z-index: -1;
            transform-origin: left;
            transition: width 0.3s ease;
        }

        .range-cell span {
            z-index: 2;
            position: relative;
        }

        .controls {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .top-controls {
            width: calc(100% - 40px);
            margin: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .weight-control {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #4CAF50;
        }
.color-weight-group {
    display: flex;
    align-items: center;
    gap: 10px;
}

.color-input {
    width: 40px;
    height: 30px;
    padding: 0;
    border: 1px solid #444;
    border-radius: 4px;
    background: #1a1a1a;
    cursor: pointer;
}
        .stats-container {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .stat-box {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #4CAF50;
        }

        .stat-value {
            background: #1a1a1a;
            padding: 5px 10px;
            border-radius: 4px;
            border: 1px solid #444;
            min-width: 50px;
            text-align: center;
        }

        .weight-input {
            width: 60px;
            background: #1a1a1a;
            color: #4CAF50;
            border: 1px solid #444;
            padding: 5px;
            border-radius: 4px;
            text-align: center;
        }

        .clear-button {
            padding: 8px 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .clear-button:hover {
            background-color: #45a049;
        }

.range-text {
    width: calc(100% - 40px);
    height: 40px;
    background-color: #1a1a1a;
    color: #4CAF50;
    border: 1px solid #444;
    padding: 10px;
    margin-top: 30px;  /* Increased from 20px to 30px */
    font-family: Arial, sans-serif;
    resize: none;
}

.save-button {
    width: calc(100% - 40px);
    margin-top: 5px;
}

         .cell[draggable="true"] {
            cursor: move;
        }
    </style>
</head>

<body>
    <div class="main-container">
        <div class="controls">
            <button id="viewModeBtn" class="button active" onclick="toggleViewMode()">View Mode</button>
            <button id="rangeBuilderBtn" class="button" onclick="toggleRangeBuilder()">Range Builder</button>
        </div>
        <div class="grid-container" id="grid"></div>
    </div>

    <div class="sidebar" id="sidebar">
        <h2>Range Builder</h2>
        <div class="range-grid" id="rangeGrid"></div>
        <div class="top-controls">
            <div class="weight-control">
                <div class="color-weight-group">
                    <label>Color:</label>
                    <input type="color" id="colorPicker" value="#4CAF50" class="color-input">
                    <label for="weightInput">Weight:</label>
                    <input type="number" id="weightInput" value="100" min="0" max="100" 
                           class="weight-input" onchange="updateWeight(this.value)">
                    <span>%</span>
                </div>
            </div>
            <div class="stats-container">
                <div class="stat-box">
                    <span>Range:</span>
                    <span id="rangePercent" class="stat-value">0%</span>
                </div>
                <div class="stat-box">
                    <span>Combos:</span>
                    <span id="comboCount" class="stat-value">0</span>
                </div>
            </div>
            <button class="clear-button" onclick="clearSelection()">Clear</button>
        </div>
        <textarea id="rangeText" class="range-text" 
                  oninput="handleRangeTextChange(event)"></textarea>
        <button class="button save-button" onclick="saveToCell()">Save to Cell</button>
    </div>
    <script>
    let isViewMode = true;
    let isRangeBuilderOpen = false;
    let selectedCell = null;
    const cellData = new Map();
    let currentWeight = 100;
    let isMouseDown = false;
    let isSelecting = null;

    function createGrid() {
        const grid = document.getElementById('grid');
        for (let i = 0; i < 8; i++) {
            for (let j = 0; j < 8; j++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                const cellId = `${String.fromCharCode(65 + j)}${i + 1}`;
                
                const cellContent = document.createElement('div');
                cellContent.className = 'cell-content';
                
                const cellIdSpan = document.createElement('span');
                cellIdSpan.className = 'cell-id';
                cellIdSpan.textContent = cellId;
                
                cell.appendChild(cellIdSpan);
                cell.appendChild(cellContent);
                cell.dataset.id = cellId;
                
                cell.addEventListener('click', selectCell);
                cell.setAttribute('draggable', true);
                cell.addEventListener('dragstart', handleDragStart);
                cell.addEventListener('dragover', handleDragOver);
                cell.addEventListener('drop', handleDrop);
                
                grid.appendChild(cell);
            }
        }
    }

function createRangeGrid() {
    const rangeGrid = document.getElementById('rangeGrid');
    const ranks = ['A', 'K', 'Q', 'J', 'T', '9', '8', '7', '6', '5', '4', '3', '2'];
    
    for (let i = 0; i < ranks.length; i++) {
        for (let j = 0; j < ranks.length; j++) {
            const cell = document.createElement('div');
            cell.className = 'range-cell';
            
            const textSpan = document.createElement('span');
            if (i === j) {
                // Pocket pairs
                textSpan.textContent = ranks[i] + ranks[j];
            } else if (i < j) {
                // Suited hands on the right side
                textSpan.textContent = ranks[i] + ranks[j] + 's';  // Higher card first
            } else {
                // Offsuit hands on the left side
                textSpan.textContent = ranks[j] + ranks[i] + 'o';  // Swapped to put higher card first
            }
            cell.appendChild(textSpan);

            cell.addEventListener('mousedown', startRangeSelection);
            cell.addEventListener('mouseover', updateRangeSelection);
            
            rangeGrid.appendChild(cell);
        }
    }
    
    document.addEventListener('mouseup', endRangeSelection);
}

    function updateStats() {
        const selectedCells = document.querySelectorAll('.range-cell.selected');
        let totalCombos = 0;
        
        selectedCells.forEach(cell => {
            const hand = cell.querySelector('span').textContent;
            const weight = parseFloat(cell.dataset.weight || 100) / 100;
            
            let handCombos = 0;
            if (hand.length === 2) {
                // Pocket pair (AA, KK, etc.)
                handCombos = 6;
            } else if (hand.endsWith('s')) {
                // Suited hand (AKs, T9s, etc.)
                handCombos = 4;
            } else if (hand.endsWith('o')) {
                // Offsuit hand (AKo, T9o, etc.)
                handCombos = 12;
            }
            
            // Apply weight to the combos
            totalCombos += handCombos * weight;
        });
        
        // Total possible combinations = 1326
        const totalPossibleCombos = 1326;
        
        // Calculate range percentage
        const rangePercentage = (totalCombos / totalPossibleCombos * 100).toFixed(1);
        
        // Update the display
        document.getElementById('rangePercent').textContent = rangePercentage + '%';
        document.getElementById('comboCount').textContent = Math.round(totalCombos);
    }

    function clearSelection() {
        document.querySelectorAll('.range-cell.selected').forEach(cell => {
            cell.classList.remove('selected');
            cell.style.removeProperty('--weight-height');
            delete cell.dataset.weight;
        });
        document.getElementById('rangeText').value = '';
        updateStats();
    }

    function handleRangeTextChange(e) {
        const text = e.target.value.trim();
        
        document.querySelectorAll('.range-cell.selected').forEach(cell => {
            cell.classList.remove('selected');
            cell.style.removeProperty('--weight-height');
            delete cell.dataset.weight;
        });
        
        if (text) {
            const weightGroups = text.match(/\[\d+\][^[]+\[\/\d+\]/g) || [];
            weightGroups.forEach(group => {
                const weight = group.match(/\[(\d+)\]/)[1];
                const hands = group.match(/\]([^[]+)\[/)[1].split(',');
                
                hands.forEach(hand => {
                    const cell = [...document.querySelectorAll('.range-cell')]
                        .find(cell => cell.querySelector('span').textContent.trim() === hand.trim());
                    if (cell) {
                        cell.classList.add('selected');
                        cell.style.setProperty('--weight-height', `${weight}%`);
                        cell.dataset.weight = weight;
                    }
                });
            });
        }
        updateStats();
    }

    function startRangeSelection(e) {
        isMouseDown = true;
        const cell = e.target.closest('.range-cell');
        isSelecting = !cell.classList.contains('selected');
        toggleRangeCell(cell);
    }

    function updateRangeSelection(e) {
        if (!isMouseDown || isSelecting === null) return;
        const cell = e.target.closest('.range-cell');
        if (!cell) return;
        
        if (cell.classList.contains('selected') !== isSelecting) {
            toggleRangeCell(cell);
        }
    }

    function endRangeSelection() {
        isMouseDown = false;
        isSelecting = null;
    }

    function updateWeight(value) {
        currentWeight = Math.min(Math.max(0, value), 100);
        document.getElementById('weightInput').value = currentWeight;
    }

    function toggleViewMode() {
        isViewMode = true;
        isRangeBuilderOpen = false;
        
        document.getElementById('viewModeBtn').classList.add('active');
        document.getElementById('rangeBuilderBtn').classList.remove('active');
        
        document.getElementById('sidebar').style.display = 'none';
    }

    function toggleRangeBuilder() {
        isRangeBuilderOpen = !isRangeBuilderOpen;
        isViewMode = !isRangeBuilderOpen;
        
        document.getElementById('viewModeBtn').classList.toggle('active', !isRangeBuilderOpen);
        document.getElementById('rangeBuilderBtn').classList.toggle('active', isRangeBuilderOpen);
        
        document.getElementById('sidebar').style.display = isRangeBuilderOpen ? 'flex' : 'none';
    }

    function toggleRangeCell(cell) {
        cell.classList.toggle('selected');
        if(cell.classList.contains('selected')) {
            cell.style.setProperty('--weight-height', `${currentWeight}%`);
            cell.dataset.weight = currentWeight;
        } else {
            cell.style.removeProperty('--weight-height');
            delete cell.dataset.weight;
        }
        updateRangeText();
        updateStats();
    }

    function updateRangeText() {
        const selectedCells = [...document.querySelectorAll('.range-cell.selected')];
        const handsByWeight = {};
        
        selectedCells.forEach(cell => {
            const weight = cell.dataset.weight || 100;
            if (!handsByWeight[weight]) {
                handsByWeight[weight] = [];
            }
            handsByWeight[weight].push(cell.querySelector('span').textContent);
        });
        
        const formattedGroups = Object.entries(handsByWeight)
            .map(([weight, hands]) => `[${weight}]${hands.join(',')}[/${weight}]`);
        
        document.getElementById('rangeText').value = formattedGroups.join(',');
    }

    function selectCell(e) {
        if (!isViewMode) return;
        if (selectedCell) {
            selectedCell.style.border = '1px solid #444';
        }
        selectedCell = e.currentTarget;
        selectedCell.style.border = '2px solid #4CAF50';
    }

    function saveToCell() {
        if (!selectedCell) {
            alert('Please select a cell first');
            return;
        }
        
        const rangeText = document.getElementById('rangeText').value;
        cellData.set(selectedCell.dataset.id, rangeText);
        
        const content = selectedCell.querySelector('.cell-content');
        content.innerHTML = '📝';
        
        toggleRangeBuilder();
    }

    function handleDragStart(e) {
        if (!isViewMode) return;
        e.dataTransfer.setData('text/plain', e.target.dataset.id);
    }

    function handleDragOver(e) {
        if (!isViewMode) return;
        e.preventDefault();
    }

    function handleDrop(e) {
        if (!isViewMode) return;
        e.preventDefault();
        const sourceId = e.dataTransfer.getData('text/plain');
        const targetId = e.target.closest('.cell').dataset.id;
        
        const sourceData = cellData.get(sourceId);
        const targetData = cellData.get(targetId);
        
        if (sourceData) cellData.set(targetId, sourceData);
        if (targetData) cellData.set(sourceId, targetData);
        
        updateCellContent(sourceId);
        updateCellContent(targetId);
    }

    function updateCellContent(cellId) {
        const cell = document.querySelector(`[data-id="${cellId}"]`);
        const content = cell.querySelector('.cell-content');
        const data = cellData.get(cellId);
        content.innerHTML = data ? '📝' : '';
    }

    document.addEventListener('DOMContentLoaded', () => {
        createGrid();
        createRangeGrid();
        toggleViewMode();
    });
</script>
</body>
</html>
